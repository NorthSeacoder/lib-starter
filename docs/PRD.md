# 产品需求文档 (PRD)

> 📌 项目: @nsea/starter 现代化 TypeScript 脚手架  
> 📅 版本: v1.0  
> 📄 目标: 将现有模板仓库升级为完整的脚手架工具

---

## 1. 背景与目标

### 1.1 背景

当前仓库 @nsea/starter 提供了一个 TypeScript 库的开发模板，包含完整的工程化配置，但核心业务能力尚未实现。随着 TypeScript 生态的成熟，用户期望通过一条命令即可创建一个包含现代工程化配置的项目，减少繁琐的手动配置工作。

### 1.2 目标

构建一个现代化的 TypeScript 脚手架工具，提供多种模板、交互式 CLI、插件扩展能力，帮助用户快速搭建高质量的项目基础设施。

### 1.3 KPI

| 指标                 | 2024 Q4 目标 |
| -------------------- | ------------ |
| CLI 初始化成功率     | ≥ 98%        |
| 官方模板数量         | ≥ 3 个       |
| 单元测试覆盖率       | ≥ 85%        |
| CLI 交互流程体验评分 | ≥ 4.5/5      |
| NPM 下载量           | 1000+/月     |

---

## 2. 用户与场景

### 2.1 用户画像

1. **独立开发者**
   - 需求: 快速初始化项目
   - 痛点: TypeScript 配置复杂、工具链多

2. **团队负责人**
   - 需求: 统一项目结构和规范
   - 痛点: 团队成员水平不一，项目管理困难

3. **架构师/高级开发**
   - 需求: 可扩展脚手架，整合企业内部工具
   - 痛点: 脚手架扩展困难，维护成本高

4. **技术布道者/教育者**
   - 需求: 展示最佳实践和 Demo
   - 痛点: 缺少标准化模板和文档

### 2.2 核心使用场景

1. **创建一个 TypeScript 库项目**
   - 命令: `pnpm create @nsea/starter my-lib`
   - 流程: 选择模板 → 配置选项 → 生成项目 → 下一步提示

2. **批量生成项目模板**
   - 场景: 团队建立多个类似项目
   - 需求: 支持脚本化、非交互式执行

3. **自定义模板**
   - 场景: 团队或个人维护自定义模板
   - 需求: 本地模板 + 远程模板 + 版本化

4. **扩展脚手架功能**
   - 场景: 添加企业内部工具或流程
   - 需求: 插件机制、生命周期钩子

---

## 3. 功能需求

### 3.1 功能概览

| 模块       | 描述                         | 优先级 |
| ---------- | ---------------------------- | ------ |
| 模板管理   | 管理和加载项目模板           | P0     |
| CLI 初始化 | 提供交互引导和命令行选项     | P0     |
| 核心执行器 | 任务编排、文件处理、变量替换 | P0     |
| 配置系统   | 合并 CLI、配置文件、环境变量 | P0     |
| 插件系统   | 插件注册、生命周期钩子       | P1     |
| 日志系统   | 日志分级、进度展示、调试信息 | P1     |
| 缓存与幂等 | 缓存执行结果、防止重复操作   | P1     |
| 文档与教程 | 完整文档、教程、案例         | P1     |
| 遥测与分析 | 可选使用统计、版本提示       | P2     |
| 生态扩展   | VSCode 扩展、在线 Playground | P2     |

### 3.2 详细需求

#### A. 模板管理（P0）

- 支持本地模板 (`templates/`)
- 支持远程模板（Git 仓库、npm 包）
- 模板元信息（名称、描述、标签、版本）
- 模板变量定义（JSON/TS）

> 📘 详见《[远程模板仓库设计方案](./remote-template-registry.md)》与《[远程模板仓库 - 快速概览](./REMOTE-TEMPLATE-SUMMARY.md)》，获取完整架构与实施细节。

#### B. CLI 初始化流程（P0）

- 命令: `create`, `template list`, `template update`
- 交互式问答（项目名称、模板、特性）
- 支持 `--template`, `--config`, `--yes` 非交互模式
- 支持 dry-run 预览

#### C. 核心执行器（P0）

- 任务队列（模板复制、变量替换、安装依赖等）
- 文件冲突检测（提示覆盖、跳过、合并）
- 异常处理与回滚机制
- 支持同步/异步任务

#### D. 配置系统（P0）

- 支持 `.starterrc.json`, `.starterrc.ts`, `starter.config.js`
- YAML/JSON/TS 格式
- CLI > config 文件 > env > 模板默认值
- Schema 校验（zod/valibot）

#### E. 插件系统（P1）

- 插件定义接口（`StarterPlugin`）
- 生命周期钩子 (`onInit`, `onBeforeTask`, `onAfterTask`, `onComplete`, `onError`)
- 插件注册与加载机制
- 官方插件示例（eslint、prettier、vitest、ci）

#### F. 日志与进度（P1）

- 支持 log level（info/debug/warn/error）
- 进度条、任务状态反馈
- 结构化日志输出（可选 JSON）
- `--verbose`, `--debug` 模式

#### G. 缓存与幂等（P1）

- 缓存执行步骤结果
- 检测文件变化
- 提供 `--force` 强制覆盖

#### H. 文档与教程（P1）

- README + docs/ 双语文档
- Quick Start、FAQ、Troubleshooting
- 示例项目（examples/）
- API 文档（Typedoc）

#### I. 遥测与分析（P2）

- 可选匿名使用统计（可关闭）
- 版本更新提示
- 错误上报（可选）

#### J. 生态扩展（P2）

- VSCode 插件（模板选择、配置生成）
- 在线 Playground（可选）
- 官方模板仓库

---

## 4. 非功能需求

| 类别     | 要求                                       |
| -------- | ------------------------------------------ |
| 性能     | 模板初始化 < 30 秒；CLI 响应迅速           |
| 可用性   | CLI 100% 覆盖常见错误处理；提供 debug 指南 |
| 安全性   | 远程模板需校验；命令执行需提示用户         |
| 国际化   | CLI 输出支持中英文（可切换或自动检测）     |
| 可维护性 | 模块化设计；代码遵循 ESLint/Prettier 规范  |
| 可扩展性 | 插件 API 稳定；模板可轻松扩展              |
| 兼容性   | 支持 macOS/Linux/Windows；Node.js ≥ 20     |

---

## 5. 里程碑

| 里程碑 | 内容                             | 目标时间   |
| ------ | -------------------------------- | ---------- |
| M1     | 核心执行器 + 模板渲染 + CLI 基础 | T0 + 2 周  |
| M2     | 交互式 CLI + 配置系统 + 多模板   | T0 + 4 周  |
| M3     | 插件系统 + 日志/进度 + 缓存      | T0 + 6 周  |
| M4     | 文档/示例 + CI 扩展 + Typedoc    | T0 + 8 周  |
| M5     | Beta 发布 + 反馈收集 + 性能优化  | T0 + 10 周 |
| M6     | v1.0 正式发布                    | T0 + 12 周 |

---

## 6. 成功指标 & 验收标准

- ✅ 支持至少 3 个模板（library、cli、monorepo）
- ✅ CLI 交互流程完善（交互式、非交互式）
- ✅ 插件机制可加载官方插件
- ✅ 文档完整（README + API + FAQ + 示例）
- ✅ 覆盖率达标；CI 稳定
- ✅ MVP Beta 用户测试反馈正面（NPS ≥ 8）

---

## 7. 附录

### 7.1 名词解释

- **模板**: 可被复制和渲染的项目骨架
- **插件**: 扩展脚手架功能的模块（可注入任务）
- **Hook/Lifecycle**: 插件在不同阶段执行的入口

### 7.2 外部依赖建议

- `prompts` / `inquirer`: CLI 交互
- `eta` / `handlebars`: 模板引擎
- `zod`: 配置校验
- `ora` / `listr2`: 进度显示
- `p-queue`: 并发控制
- `winston` / `pino`: 日志系统

---

**文档维护者**: Product Team  
**最后更新**: 2024-11
